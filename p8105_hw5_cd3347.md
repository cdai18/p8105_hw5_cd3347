Homework 5
================
Christina Dai

# Problem 2

## Create tidy dataframe

Dataframe including all file names:

``` r
study_df = 
  tibble(
     files = list.files("./data")
  )
```

Iterate over file names and include results in a new variable:

``` r
setwd("~/P8105/p8105_hw5_cd3347/data")
study_df = 
  study_df %>% 
  mutate(
    data = map(files, read_csv)
  )
```

Tidy data:

``` r
study_df_tidy = 
  study_df %>% 
  unnest(data) %>% 
  mutate(files = str_remove(files, ".csv")) %>% 
  separate(col = files, into = c("arm", "id"), sep = "_") %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "value"
  ) %>% 
  mutate(
    week = str_remove(week, "week_")
  ) %>% 
  mutate(
    arm = str_replace(arm, "con", "control"),
    arm = str_replace(arm, "exp", "experiment")
    )
```

Make a spaghetti plot of observations over time:

``` r
study_df_tidy %>% 
  ggplot(aes(x = week, y = value, group = id, color = id)) + 
  geom_line() + 
  facet_grid(. ~ arm)
```

<img src="p8105_hw5_cd3347_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" />

The experiment group and control group start around the same point in
week 1, but the experiment groupâ€™s values show an increase over time
while the control group is stagnant.

# Problem 3

Fix n and sigma:

``` r
sim_datasets = function(mu, n = 30, sigma = 4) {
  
  tibble(
    x = rnorm(n = n, mean = mu, sd = sigma)
  )

}
```

Generate 5000 datasets for mu = 0:

``` r
mu_0 = 
  tibble(
    mu = 0
  ) %>% 
  mutate(
    datasets = map(.x = mu, ~ map(1:5000, ~ sim_datasets(.x)))
  ) %>% 
  unnest(datasets)
```

Conduct t test on each dataset and save the estimate and p-value:

``` r
t_test_0 = function(df, mu = 0) {
  
  t.test(x = df, mu = mu) %>% 
    broom::tidy()
  
}

mu_0_test = 
  mu_0 %>% 
  mutate(ttest = map(datasets, t_test_0)) %>% 
  unnest(ttest) %>%
  mutate(mu_value = 0) %>% 
  select(-statistic, -parameter, -conf.low, -conf.high, -method, -alternative, -datasets, -mu) %>% 
  relocate(mu_value) %>% 
  janitor::clean_names()
```

Conducting the test on mu = 1, 2, 3, 4, 5, 6:

``` r
t_test_all = function(df, mu_values = c(1, 2, 3, 4, 5, 6)) {
  
  map_df(mu_values, ~t.test(x = df, mu = .x) %>% broom::tidy() %>% mutate(mu_value = .x))
  
}

mu_all_test = 
  map_df(mu_0$datasets, t_test_all) %>% 
  select(mu_value, estimate, p.value) %>% 
  janitor::clean_names() %>% 
  arrange(mu_value)
```

Binding the rows together so we can create a plot:

``` r
htests = 
  bind_rows(mu_0_test, mu_all_test)
```

Make a plot showing proportion of times the null was rejected and true
value of mu.

``` r
prop_plot = 
  htests %>% 
  mutate(reject = (p_value <= 0.05)) %>% 
  group_by(mu_value, reject) %>% 
  summarize(is_true = n()) %>% 
  filter(reject == "TRUE") %>% 
  mutate(proportion = is_true / 5000) %>% 
  ggplot(aes(x = mu_value, y = proportion)) + 
  geom_point() + 
  geom_line()
```

    ## `summarise()` has grouped output by 'mu_value'. You can override using the
    ## `.groups` argument.
